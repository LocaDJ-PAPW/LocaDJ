# Define a versão do schema do Render
services:
  # Define um serviço do tipo "web" (um servidor HTTP)
  - type: web
    # Nome do seu serviço (pode ser qualquer um)
    name: locadj-api
    # Informa ao Render para usar o Docker para construir e executar
    env: docker
    # Faz deploy automático a cada push na branch principal (ex: main ou master)
    autoDeploy: true
    # Define o plano. 'starter' é o plano gratuito.
    # Para produção, considere 'standard' ou superior.
    plan: starter
    # Informa ao Render qual porta sua aplicação expõe (do EXPOSE no Dockerfile)
    httpPort: 8080

    # Health check para saber se a aplicação iniciou com sucesso
    healthCheck:
      # O Spring Boot com JPA pode demorar um pouco para iniciar.
      # Damos 120 segundos de "carência" antes do primeiro health check.
      initialDelaySeconds: 120
      # O Render vai checar este endpoint.
      # Se você adicionar o Spring Boot Actuator, é recomendado mudar para /actuator/health
      path: /

    # Variáveis de ambiente.
    # Você deve definir os valores para as chaves com 'fromEnv'
    # no dashboard do Render, na seção 'Environment'.
    envVars:
      # --- Banco de Dados Externo (Aiven) ---
      - key: SPRING_DATASOURCE_URL
        fromEnv: DB_URL # No Render, crie DB_URL e cole "jdbc:mysql://mysql-3fa0..."
      - key: SPRING_DATASOURCE_USERNAME
        fromEnv: DB_USER # No Render, crie DB_USER e cole "avnadmin"
      - key: SPRING_DATASOURCE_PASSWORD
        fromEnv: DB_PASS # No Render, crie DB_PASS e cole sua senha AVNS_eZrp...
      - key: SPRING_DATASOURCE_DRIVER_CLASS_NAME
        value: com.mysql.cj.jdbc.Driver

      # --- Configurações do Hibernate/JPA ---
      - key: SPRING_JPA_HIBERNATE_DDL_AUTO
        value: update
      - key: SPRING_JPA_SHOW_SQL
        value: "true"
      - key: SPRING_JPA_PROPERTIES_HIBERNATE_DIALECT
        value: org.hibernate.dialect.MySQL8Dialect

      # --- API Mercado Pago (SECRETO) ---
      - key: API_V1_MERCADOPAGO_ACCESS_TOKEN
        fromEnv: MERCADOPAGO_TOKEN # No Render, crie MERCADOPAGO_TOKEN e cole seu token APP_USR-...

      # --- Webhook URL (IMPORTANTE) ---
      # O NGROK não funciona em produção.
      # O Render usa a URL pública do serviço.
      # A URL será: https://<name>.onrender.com + /api/v1/webhooks/mercadopago
      - key: API_V1_MERCADOPAGO_NOTIFICATION_URL
        value: https://locadj-api.onrender.com/api/v1/webhooks/mercadopago